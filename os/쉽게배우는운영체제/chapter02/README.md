# 2. 컴퓨터의 구조와 성능 향상

## 컴퓨터의 기본 구성
### 하드웨어의 구성
컴퓨터는 CPU, 메인메모리, 입/출력 장치, 저장 장치로 구성  
메인메모리는 전력이 끊기면 데이터를 잃어버리기 때문에 데이터를 영구히 보관하려면 하드디스크나 USB 메모리를 사용해야함
### CPU와 메모리
- CPU는 명령어를 해석하여 실행
- 메모리는 작업에 필요한 프로그램과 데이터를 저장, 바이트로 단위로 분할되어 있으며 분할 공간마다 주소로 구분
### 입출력장치
- 입력장치: 외부의 데이터를 컴퓨터에 입력하는 장치
- 출력장치: 컴퓨터에서 처리한 결과를 사용자가 원하는 형태로 출력하는 장치
### 저장장치
- 저장장치는 메모리보다 느리지만 저렴하고 용량이 크며, 전원 상관없이 데이터를 영구적으로 저장
- 자성을 이용하는 장치: 카세트테이프, 플로피디스크, 하드디스크
- 레이저를 이용한느 장치: CD, DVD
- 메모리를 이용하는 장치: USB, SD 카드, SSD
### 메인보드
- CPU와 메모리 등 다양한 부품을 연결하는 커다란 판
- 컴퓨터의 다양한 부품은 버스로 연결
    - 버스는 일정한 규칙에 따라 각 장치에 데이터를 전송하는 역할
- 그래픽카드, 사운드카드, 랜카드 등을 장착
### 폰노이만 구조 특징
- 모든 프로그램은 메모리에 올라와야 실행할 수 있다
### 하드웨어 사양 관련 용어
- 클록 (clock)
    - CPU의 속도와 관련된 단위
    - 클록이 일정 간격으로 틱(Tick)을 만들면 거기에 맞추어 CPU안의 모든 구성 부품이 작업을 함
    - 틱은 펄스(pulse) 또는 클록틱 (clock tick)이라고 부름
    - 메인보드의 클록이 틱을 보낼 때마다 데이터를 보내거나 받음
- 헤르츠 (HZ)
    - 클릭 틱이 발생하는 속도를 나타내는 단위
    - 1초에 클록 틱이 몇 번 발생하는지를 나타내는데, 1초에 클록 틱이 한 번이면 1HZ, 1000번이면 1kHZ(1,000HZ)
- 시스템 버스와 CPU 내부 버스
    - 시스템 버스는 메모리와 주변 장치를 연결하는 버스로 FSB(First-Side Bus)
    - CPU 내부 버스는 CPU 내부에 있는 장치를 연결하는 버스로 BSB(Back-Side Bus)
        - CPU 내부 버스와 속도는 CPU의 클록과 같아서 시스템 버스보다 훨씬 빠름
    - CPU는 CPU 내부 버스의 속도로 작동하고 메모리는 시스템 버스의 속도로 작동하기 때문에 두 버스의 속도 차이로 인해 작업이 지연되는 문제가 발생

## CPU와 메모리
### CPU의 기본 구성
- 산술논리 연산장치: 데이터의 덧셈, 뺄셈, 곱셈, 나눗셈 같은 산술연산과 AND, OR 같은 논리 연산 수행
- 제어장치: CPU에서 작업을 지시하는 부분
- 레지스터: CPU 내에 데이터를 임시로 보관하는 곳
### 레지스터의 종류
- 데이터 레지스터(DR)
    - 메모리에서 가져온 데이터를 임시로 보관할 때 사용
    - CPU에 있는 대부분의 레지스터가 데이터 레지스터이기 때문에 일반 레지스터 또는 범용 레지스터라고 부름
- 주소 레지스터(AR)
    - 데이터 또는 명령어가 저장된 메모리의 주소 저장
- 프로그램 카운터(PC)
    - 다음에 실행할 명령어의 주소를 기억하고 있다가 제어장치에 알려줌
- 명령어 레지스터(IR)
    - 현재 실행 중인 명령어를 저장
    - 명령어 레지스터에 있는 명령을 해석 후 외부 장치에 적절한 제어 신호를 보냄
- 메모리 주소 레지스터(MAR)
    - 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼 때 주소를 지정하기 위해 사용
- 메모리 버퍼 레지스터(MBR)
    - 메모리에서 가져온 데이터나 메모리로 옮겨 갈 데이터를 임시로 저장
    - 메모리 버퍼 레지스터는 항상 메모리 주소 레지스터와 함께 동작
### 메모리의 종류와 부팅
- 휘발성 메모리
    - DRAM, SRAM이 해당
    - DRAM은 시간이 지나면 데이터가 사라지기 때문에 재생이 필요하다는 의미
    - SRAM은 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요 없음
    - 메인메모리는 DRAM, 캐시 같은 고속 메모리는 SRAM을 사용
- 비휘발성 메모리
    - 플래시 메모리, FRAM, PRAM 해당
    - 램과 달리 롬은 전력이 끊겨도 데이터를 보관하는 것이 장점, 한 번 저장하면 바꿀 수 없음 (바이오스)
### 메모리 보호
- 사용자 영역의 작업이 운영체제 영역으로 침범하지 못하도록 막는 것
- 운영체제의 작업이 중단된 상태에서 사용자의 작업으로부터 메모리를 보호하려면 하드웨어의 도움이 필요
- 메모리를 보호하기 위해 CPU는 현재 진행 중인 작업의 메모리 시작 주소를 **경계 레지스터**에 저장한 후 작업
- 현재 진행 중인 작업의 메모리 크기, 즉 마지막 주소까지의 차이를 **한계 레지스터**에 저장
- 경계 레지스터, 한계 레지스터

## 컴퓨터 성능 향상 기술
### 버퍼
- 버퍼는 속도에 차이가 있는 두 창지 사이에 그 차이를 완화하는 역할을 함
- 일정양의 데이터를 모아 한꺼번에 전송하면 적은 노력으로 많은 양의 데이터를 옮길 수 있음
### 스풀
- 스풀은 CPU와 입출력장치가 독립적으로 동작하도록 설계된 소프트웨어적 버퍼
    - 프린트 출력 명령을 내린 프로그램과 독립적으로 동작 
### 캐시
- 캐시는 메모리와 CPU 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해두는 임시 저장소
- CPU가 앞으로 사용할 것으로 예상되는 데이터를 미리 저장
- 캐시는 CPU 안에 있으며 CPU 내부 버스의 속도로 작동 (메모리의 경우 시스템 버스의 속도록 작동하기 때문에 느림)
- CPU는 메모리에 접근해야 할 때 캐시를 먼저 방문하여 원하는 데이터가 있는지 확인
    - 캐시에서 데이터를 찾으면 캐시 히트(cache hit)라고 함
    - 캐시에 원하는 데이터가 존재하지 않으면 메모리에 접근하여 데이터를 찾는데 이를 캐시 미스 (cache miss)라고 함
    - 캐시 히트가 되는 비율은 캐시 적중룔(cache hit ratio)라고 하며, 일반적인 컴퓨터의 캐시 적중률은 90%임 (컴퓨터의 성능을 향상하려면 캐시 적중률이 높아야함)
- 캐시 적중률을 높이는 방법
    - 캐시의 크기가 높은 경우
    - 앞으로 많이 사용될 데이터들을 가져오기 (지역성: 현재 위치에서 가까운 데이터가 멀리 있는 데이터보다 사용될 확률이 더 높음)
### 즉시쓰기와 지연쓰기
캐시의 데이터가 변경되면 메모리의 데이터를 변경해야한다. 변경된 데이터를 메모리에 반영하기 위해서는 즉시 쓰기, 지연쓰기 방식이 있음
- 즉시 쓰기
    - 캐시 데이터가 변경 시 즉시 메모리에 반영하는 방식 (메모리에 최신 값이 항상 유지)
    - 빈번한 데이터 전송으로 인해 성능이 느려진다는 단점
- 지연 쓰기
    - 캐시 데이터가 변경 시 즉시 메모리에 반영하는 것이 아니라 변경된 내용을 모아 주기적으로 반영하는 방식, 카피백이라고도 함
    - 메모리의 데이터 전송 횟수가 줄어들어 성능상의 향상, 메모리와 캐시 사이의 데이터가 불일치가 발생할 수 있음
### L1, L2 캐시
- 캐시는 명령어와 데이터의 구분 없이 모든 자료를 가져오는 일반 캐시, 명령어와 데이터를 구분하여 가져오는 특수 캐시라는 두 가지 레벨로 구분
- L1 (Level 1) 캐시
    - 명령어의 캐시는 명령어 레지스터와 연결, 데이터 캐시는 데이터 레지스터와 연결
    - 명령어, 데이터 캐시는 CPU 레지스터에 직접 연결되어 L1 이라고 부름
- L2 (Level 2) 캐시
    - 일반 캐시는 메모리와 연결되기 때문에 L2라고 부름
### 저장장치의 계층 구조
- 속도: 레지스터 > 캐시 > 메모리 > 저장장치
- 용량: 레지스터 < 캐시 < 메모리 < 저장장치
### 인터럽트
- 인터럽트 방식은 CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템의 효율을 높임
- 동작 과정
    - CPU가 입출력 관리자에게 입출력 명령을 보냄
    - 입출력 관리자는 명령받은 데이터를 메모리에 가져다놓거나 메모리에 있는 데이터를 저장장치로 옮김
    - 데이터 전송이 완료되면 입출력 관리자는 완료 신호를 CPU에 보냄
- 입출력 관리자가 CPU에게 완료 신호를 인터럽트라고 함
### 직접 메모리 접근
- 입출력 관리자에게 CPU의 허락없이 메모리에 접근할 수 있는 권한
### 메모리 매핑 입출력
- CPU가 사용하는 메모리 공간과 직접 메모리 접근을 통해 들어오거나 나가는 데이터를 위한 공간을 분리
- 메모리의 일정 공간을 입출력에 할당하는 기법을 메모리 매핑 입출력이라고 함
### 사이클 훔치기
- CPU와 직접 메모리 접근이 동시에 메모리에 접근하면 CPU가 메모리 접근을 양보함
    - CPU의 작업 속도보다 입출력장치의 속도가 느리기 때문에 직접 메모리 접근에 양보

## 병렬 처리
동시에 여러 개의 명령을 처리하여 작업의 능률을 올리는 방식
### 파이프 라인 기법
- CPU의 사용을 극대화하기 위해 명령을 겹쳐서 실행하는 방법 (하나의 코어로 여래 개의 스레드를 사용)
- 데이터 위협, 제어 위험, 구조적 위험의 문제가 있음
- 한 클록에 한 명령어만 처리 함
### 슈퍼스칼라 기법
- 파이프라인을 처리할 수 있는 코어를 여러 개 구성하여 복수의 명령어가 동시에 실행
- 대부분의 CPU가 슈퍼스칼라 기법을 사용
### 슈퍼파이프라인 기법
- 파이프라인 기법이 강화, 한 클록 내에 여러 명령어를 처리할 수 있음
    - 한 클록 내에 여러 명령어를 실행하면 다음 명령어가 빠른 시간 안에 시작될 수 있어 병령 처리 능력이 높음
- 크레이 슈퍼컴퓨터 CPU에서 사용
### 슈퍼파이프라인 슈퍼스칼라 기법
- 슈퍼파이프라인 기법을 여러 개의 코어에서 동시에 수행하는 방식