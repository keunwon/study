# 8. 가상 메모리의 기초

## 가상 메모리의 개요
### 가상 메모리 시스템
- 가상 메모리는 물리 메모리의 크기와 상관없이 프로세스에 커다란 메모리 공간을 제공하는 기술
- 프로세스는 운영체제가 어디에 있는지, 물리 메모리의 크기가 어느정도인지 신경 쓰지 않고 메모리를 마음대로 사용할 수 있음
### 가상 메모리의 크기와 주소
- 가상 메모리 시스템의 모든 프로세스는 물리 메모리와 별개로 자신이 메모리의 어느 위치에 있는지 상관없이 0번지부터 시작하는 연속된 메모리 공간을 가짐
- DAT(Dynamic Address Translation)  
가상 메모리 시스템에서 메모리 관리자는 물리 메모리와 스왑 영역을 합쳐서 프로세스가 사용하는 가상 주소를 실제 메모리의 물리 주소로 변환하는데 이러한 작업을 동적 주소 변환 DAT라고 함
### 가상 메모리의 메모리 분할 방식
- 가상 메모리 시스템에서 가변 분할 방식을 이용한 메모리 관리 기법은 세그먼테이션, 고정 분할 방식을 이용한 메모리 관리 기법은 페이징이라고 함
- 가상 메모리 시스템에서는 세그먼테이션-페이징 혼용 기법을 주로 사용
### 매핑 테이블의 필요성과 역할
- 가상 메모리 시스템에서 가상 주소는 실제로 물리 주소나 스왑 영역 중 한 곳에 위치하며, 메모리 관리자는 가상 주소와 물리 주소를 일대일 매핑 테이블로 관리

## 페이징 기법
### 페이징 기법의 구현
- 페이징 기번은 고정 분할 방식을 이용한 가상 메모리 기법 (물리 주소 공간을 같은 크기로 나누어 사용)
- 가상 주소는 프로세스 입장에서 메모리 공간은 항상 0으로 시작
- 가상 주소와 분할된 각 영역은 페이지라고 부르며 첫 번째 영역은 페이지0, 두 번째 영역은 페이지1과 같이 관리,  
물리 메모리의 각 영역은 가상 주소의 페이지와 구분하기 위해 프레임이라고 부르며 페이지와 동일한 방식으로 번호로 관리 (페이지와 프레임의 크기는 같음)
- 어떤 페이지에 어떤 프레임이 있는지 페이지 테이블에 담겨있음 (매핑 테이블)
### 페이지 테이블 관리
- 페이지 테이블 관리가 어려운 시스템에 여러 개의 프로세스가 존재하고 프로세스마다 페이지 테이블이 하나씩 있기 때문
- 페이지 테이블은 메모리 관리자가 자주 사용하는 자료 구조이며 물리 메모리의 운영체제 영역의 일부분에 모아놓음
- 물리 메모리의 크기가 작으면 페이지 테이블의 일부도 스왑 영역으로 이동
- 각 프로세스가 메모리에 접근하려고  할때 메모리 관리자는 페이지 테이블의 위치를 재바릴 파악할 필요가 있는데 이때 **테이블 기준 레지스터**를 사용 (테이블 기준 레지스터에는 각 페이지 테이블의 시작 주소를 보관)
### 페이지 테이블 매핑 방식
- 직접 매핑
    - 페이지 테이블 전체가 물리 메모리의 운영체제 영역에 존재하는 방식 (별다른 부가 작업이 없음)
- 연관 매핑
    - 페이지 테이블 전체를 스왑 영역에서 관리하고 그 중 일부만 물리 메모리에 가지고 있음
    - 물리 메모리의 여유 공간이 작을 때 사용
    - 연관 매핑은 페이지 테이블의 일부를 무작위로 가져옴(페이지 번호와 프레임 번호 둘다 표시)
    - 메모리 내의 페이지 테이블을 위에서부터 검색하고 존재하지 않으면 스왑 영역에 있는 페이지 테이블을 검색 (시간이 많이 소요)
- 집합-연관 매핑
    - 연관 매핑의 문제를 개선한 방식
    - 페이지 테이블을 일정한 집합으로 자르고, 자른 덩어리 단위로 물리 메모리에 가져오고 만약 스왑 영역에 있으면 집합 테이블에 별도 표시를 함
- 역매핑
    - 물리 메모리의 프레임 번호를 기준으로 테이블을 구성
    - 프로세스의 수와 상관없이 테이블이 하나만 존재
    - 가상 메모리에 접근할 때 프로세스 아이디와 페이지 번호를 모두 찾아야함

## 세그먼테이션 기법
### 세그먼테이션 기법의 구현
- 세그먼트의 크기 limit, 물리 메모리상의 시작 주소를 나타내는 address가 있음
- 프로세스의 크기에 따라 메모리를 분할하기 때문에 매핑 테이블에 크기 정보를 포함
- 물리 메모리 주소가 부족하면 스왑 영역을 사용
- 메모리를 프로세스 단위로 관리하기 때문에 페이지 테이블이 작고 단순하지만 물리 메모리의 외부 단편화로 인해 물리 메모리 관리가 복잡
### 세그먼테이션-페이징 혼영기법
- 세그먼트 테이블은 메모리 권한 비트와 같이 중복되는 데이터를 관리 할때 사용하고, 페이징 테이블은 기존과 같이 프레임 번호를 관리하여 메모리를 효율적으로 사용
- 대부분의 운영체제는 이 방식을 사용