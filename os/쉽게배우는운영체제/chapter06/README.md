# 6. 교착 상태

## 교착 상태의 개요
### 교착 상태의 정의
- 2개 이상의 프로세스가 다른 프로세스의 잡업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태를 교착 상태(dead lock)라고 함

## 교착 상태 필요조건
- 상호배제: 한 프로세스가 사용하는 자원은 다른 프로세스와 공유할 수 없는 베타적인 자원이어야 함
- 비선점: 한 프로세삭 사용 중인 자원은 중간에 다른 프로세스가 빼앗을 수 없는 비선점 자원이어야 함
- 점유와 대기: 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 함
- 원형 대기: 점유와 대기를 하는 프로세스 간의 관계가 원을 이루어야 함

## 교착 상태 회피
### 교착 상태 회피의 개념
- 교착 상태 회피는 자원을 할당할 때 어느 수준 이상의 자원을 할당하면 교착 상태가 발생하는지 파악하여 그 수준 이하로 자원을 나누어주는 방식
- 교착 상태가 발생하지 않는 범위 내에서만 자원을 할당, 교착 상태가 발생하는 범위에 있으면 프로세스를 대기 상태로 변경
### 은행원 알고리즘
- 교착 상태 회를 구현한 알고리즘
- 은행이 대출을 해주는 방식, 대출 금액이 대출 간으한 범위 내이면 허용되지만 그렇지 않으면 거부되는 것과 유사하기 때문
- 은행원 알고리즘에서 각 프로세스는 자신이 사용할 자원의 최대 수를 운여체제에 알려줌  
### 은행원 알고리즘 변수
|변수|설명|
|:---|:---|
|전체 자원(Total)|시스템 내 전체 자원의 수|
|가용 자원(Available)|시스템 내 현재 사용할 수 있는 자원의 수 (가용 자원=전체자원-모든 프로세스의 할당 자원)|
|최대 자원(Max)|각 프로세스가 선언한 최대 자원의 수|
|할당 자원(Allocation)|각 프로세스에 현재 할당된 자원의 수|
|기대 자원(Expect)|각 프로세스가 앞으로 사용할 자원의 수(기대자원=최대자원-할당지원)|
### 교착 상태 회피의 문제점
- 프로세스가 자신이 사용할 모든 자원을 미리 선언해야 함
    - 프로세스가 자신이 사용할 자원의 미리 선언해야하는데 이는 쉬운 일이 아님
    - 프로세스가 자원이 정확하지 않으면 교착 상태 회피에서도 교착 상태가 발생 가능성이 있음
- 시스템의 전체 자원 수가 고정적이여야 함
    - 일시적인 고장이나 새로운 자원이 추가되는 일이 있음
- 자원 낭비
    - 모든 불안정 상태가 교착 상태가 되는 것은 아님에도 최대 자원을 사용하지 않고 작업을 마치는 경우 있음
    - 교착 상태가 발생하지 않는데도 발생할 것이라고 예상함으로써 프로세스에 자원을 할당하는데 제약을 둠
### 교착 상태 검출
- 타임아웃을 이용한 교착 상태 검출
    - 엉뚱한 프로세스가 강제 종료될 수 있음
        - 타임아웃 시간 동안 작업이 진행되지 않은 모든 프로세스가 교착 상태 때문에 작업이 이루어지지 않은 것
        - 타임아웃을 이용하면 교착 상태 외의 다른 잉유로 작업이 진행 되지 못하는 모든 프로세스가 강제 종료될 수있음
    - 모든 시스템에 적용할 수 없음
        - 운영체제 내의 프로세스를 감시하기 때문에 타임아웃 방법을 적용할 수 있음
        - 여러 군데의 데이터가 나뉘어 있는 분산 데이터베이스 경우에는 타임아웃을 이용하는 방법을 적용하기가 어려움
            - 이러한 시스템에서는 원격지에 있는 프로세스의 응답이 없는 것이 교착 상태인지, 네트워크 문제인지, 단순 처리가 늦은것인지 정확히 알 수 없음
    - 위에 문제가 있지만 대부분의 데이터베이스 운영체제가 많이 선호
### 교착 상태 회복
- 교착 상태를 일으킨 모든 프로세스를 동시에 종료
    - 종료 이후 동시에 프로세스들이 작업을 시작하면 다시 교착 상태를 일으킬 가능성이 있어 순차적으로 실행해야 함
- 교착 상태를 일으킨 프로세스 중 하나를 고랄 순서대로 종료
    - 프로세스 종료할 때 어떤 프로세스를 종료할 것이지 기준이 필요
