# 3. OS 캐시와 분산

## 8. OS의 캐시 구조
### OS의 캐시 구조를 알고 애플리케이션 작성하기 (페이지 캐시)
- OS는 메모리를 이용해서 디스크 액세스를 줄임
- Linux의 경우는 페이지 캐시, 페이지 캐시, 버퍼 캐시라고 하는 캐시 구조를 갖추고 있음
### 가상 메모리 구조
- 가상 메모리 구조는 논리적인 선형 어드레스를 물리적인 물리 어드레스로 변환하는 것
### VFS
- 드바이스 드라이버와 OS 사이에는 파일시스템이 끼어 있음
- VFS(Virtual File System)라는 추상화 레이어가 있음
    - 파일 시스템은 다양한 함수를 갖추고 있는데, 그 인터페이스를 통일하는 것이 VFS의 역할
    - 어떤 파일 시스템을 이용하더라도, 이떤 디스크를 읽어내더라도 반드시 동일한 구조로 캐싱
- VFS의 역할은 파일시스템 구현의 추상화와 성능에 관련된 페이지 캐시 부분
### Linux는 페이지 단위로 디스크를 캐싱한다
- OS는 읽은 블록 단위만으로 캐싱할 수 있는 범위가 정해짐
- 디스크를 캐싱하는 단위가 페이지
### 메모리를 늘려서 I/O 부하 줄이기
- 메모리를 늘리면 실제 I/O 부하를 줄일 수 있음
    - 메모리를 늘리면 캐시에 사용할 수 있는 용량이 늘어남
    - 캐시에 사용할 수 있는 용량이 늘어나면 보다 많은 데이터를 캐싱할 수 있음
    - 많이 캐싱하면 디스크를 읽는 횟수가 줄어듬

## 9. I/O 부하를 줄이는 방법
### 캐시를 전제로 한 I/O 줄이는 방법
- 데이터 규모에 비해 물리 메모리가 크면 전부 캐싱할 수 있으므로 이 점을 생각할 것
- 대규모 데이터 처리에는 데이터를 압축시켜서 디스크 내용을 전부 그대로 캐싱해 둘 수 있음
### 복수 서버로 확장시키기
- 데이터를 전부 캐상 할수 없는 규모가 되면 먼저 복수 서버로 확장시키는 방안을 생각해볼 필요가 있음
- DB 서버를 늘려야 할 때는 반드시 부하 때문만은 아니고 오히려 캐시 용량을 늘리고자 할 때 혹은 효율을 높이고자 할 때인 경우가 많음
- 단순히 대수를 늘리는 것만으로는 안된다
    - 캐싱할 수 없는 비율은 변함없이 그대로

## 10. 국소성을 살리는 분산
### 국소성을 고려한 분산이란?
- 국소성은 locality라고 함 (지역성)
- 데이터에 대한 액세스 패턴을 고려해서 분산시키는 것을 국소성(지역성)을 고려한 분산
### 파리셔닝 (국소성을 고려한 분산1)
- 파티셔닝은 한 대였던 DB서버를 여러 대의 서버로 분활하는 방법
- 가장 간단한 것은 '테이블 단위 분할'
    - 특정 테이블 하나를 여러 개의 작은 테이블로 분할
### 요청 패턴은 '섬'으로 분할 (국소성을 고렿나 분산2)
- 용도별로 시스템을 섬으로 나누는 방법도 있음
- 봇 이외의 액세스, 즉 사용자로부터의 액세스는 최상위 페이지나 인기 엔트리 페이지 등 최신, 인기 페이지에 거의 액세스가 집중되므로 빈번하게 참조되는 부분은 캐싱이 쉬움
