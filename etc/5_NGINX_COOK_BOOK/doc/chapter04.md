# 4. 대규모 확장 가능한 콘텐츠 캐싱

## 4.0. 소개
- 캐싱은 미래에 다시 제공해야 하는 응답을 저장해뒀다가 빠르게 콘텐츠를 제공하는 방법
- 캐싱 기능은 http 컨텍스트 내에서만 사용할 수 있음
## 4.1. 캐시 영역
- 'proxy_cache_path' 지시자를 사용해 공유 메모리 캐시 영역을 정의하고 콘텐츠의 위치를 지정
- 'proxy_cache' 지시자는 http, server, location 블록에 사용 가능
## 4.2. 캐시 락
- 'proxy_cache_lock' 지시자는 동일한 리소스에 대한 요청이 여러 개 들어오면 한 번에 하나의 요청을 통해서만 캐시가 만들어지도록 함
- 'proxy_cache_lock_age': 캐시 생성이 오래 걸리면 대기 중인 요청을 보내서 캐시를 만듬
- 'proxy_cache_lock_time': 캐시 생성이 오래 걸리면 대기 중인 요청을 보냄지만 캐시를 생성하지 않음
## 4.3. 해시 키 값 캐시
- 캐시 적중/실패 기준을 정의하는데 'proxy_cache_key' 지시자와 변수를 사용함
- http, server, location 블록에 사용
## 4.4. 캐시 우회
- 'proxy_cache_bypass'에 값을 지정해 캐시를 우회
## 4.5. 캐시 성능
- 사용자 환경에서 유효한 'Cache-Control' 헤더를 사용 
    - Cache-Control "public": 사용자에게 전달되는 중간에 위치한 서버라도 리소스를 캐시하도록 함
    - Cache-Control "private": 실제 사용사 환경에서만 리소스를 캐시
## 4.7. 캐시 분할
- 'slice' 지시자와 내장 변수를 사용해 캐시 결과를 작은 조각으로 나눔
- 'proxy_set_header' 지시자를 사용해 원본 서버로 요청을 보낼 때 'Range' 헤더를 추가하고 헤더 값으로 '$slice_range' 변수값을 쓰도록 지정' (HTTP의 바이트 레인지 요청을 사용할 수 있음, 단 HTTP 버전이 1.1)
- 캐시 분할 모듈은 바이트 레인지를 사용하는 HTML5 비디오를 위해 개발
- 캐시 분할 모듈은 변경되지 않고 용량이 큰 파일에만 적용해야 함
