# 3. 네트워크의 공통 언어 TCP/IP

## 3.1. 네트워크의 공통 언어
- TCP/IP의 계층구조
	- 애플리케이션 (HTTP, SMTP, POP3, DHCP, DNS 등)
	- 트랜스포트 (TCP/UDP)
	- 인터넷 (IP, ICMP, ARP 등)
	- 네트워크 인터페이스 (이더넷, 무선 LAN, PPP 등)

## 3.2. 데이터를 전송하는 역할을 하는 계층
- 네트워크 인터페이스
	- 같은 네트워크 안에서 데이터를 전송
	- 네트워크 인터페이스층의 프로토콜이 통신 상대와 같아야 할 필요는 없음
- 인터넷
	- 네트워크 사이에서 데이터를 전달하는 역할
	- 네트워크를 연결하고 데이터를 전송하는 기기는 라우터(라우팅 사용)
	- 출발지와 목적지 사이의 데이터 전송을 가리켜 **엔드투엔드 통신**이라고 함
	- IP, COMP, ARP 등의 프로토콜 사용

## 3.3. 애플리케이션의 동작을 준비하는 계층
- 트랜스포트
	- 데이터를 적절한 애플리케이션에 배분
	- TCP/UDP 프로토콜 사용
- 애플리케이션
	- 데이터의 형식과 처리 절차 등을 결정
 	- HTTP, SMTP, POP, DHCP, DNS 등의 프로토콜 사용

## 3.4. 데이터 송수신 규칙
- 프로토콜의 제어정보 **헤더**를 만든다
	- 만약 데이터를 전송하는 프로토콜이라면, 헤더에는 출발지와 목적지 주소가 지정
	- 헤더를 추가하는 것을 **캡슐화**라고 부름
	- **역캡슐화(비캡슐화)**: 프로토콜 헤더를 바탕으로 적절히 처리하고 헤더를 벗겨내고 다른 프로토콜로 처리

## 3.5. 데이터 수신, 전송할 때의 규칙
- 헤더로 목적지를 확인하고 수신한다
	1. 웹서버 애플리케이션이 동작하는 웹서버까지 물리적인 신호가 도착하면, 0과1 데이터로 변환
	2. 이더넷 헤더를 참조해 목적지에 맞게 왔는지 확인,  
		이더넷 헤더와 FCS를 제거하고 IP 헤더 처리를 넘김
	4. IP 헤더를 참조해 자기 앞으로 온 데이터인지 확인,  
		IP 헤더를 제거하고 TCP로 데이터 처리를 넘김
	5. TCP 헤더를 참조해 어느 애플리케이션의 데이터인지 확인,  
		TCP 헤더를 제거하고 웹서버 애플리케이션으로 데이터 처리를 넘김
	6. 웹서버 애플리케이션까지 데이터가 도달하면, HTTP 헤더와 그 뒤의 데이터 부분을 처리

## 3.6. 데이터를 부르는 방법은 다양하다
- 계층별로 데이터를 부르는 방법
	- 애플리케이션: 메시지
	- 트랜스포트: 세그먼트 or 데이터그램(TCP 이용 시 세그먼트, UDP 이용 시 데이터 그램)
	- 인터넷: 패킷 or 데이터그램(IP 패킷 or IP 데이터그램)
	- 네트워크 인터페이스: 프레임
- 데이터를 부르는 방법
	- HTTP 메시지: 웹브라우저의 데이터 HTTP 헤더를 추가
	- TCP 세그먼트: HTTP 메시지에 TCP 헤더를 추가
	- IP 패킷: TCP 세그먼트에 IP 헤더를 추가
	- 이더넷 프레임: IP 패킷에 이더넷 헤더와 FCS 추가
> 라우터는 인터넷 레벨의 네트워크 기기  
레이어2 스위치는 네트워크 인터페이스에 동작하는 네트워크 기기

## 3.7. 데이터를 목적지까지 전송한다
- IP(Internet Protocl)란?
	- IP의 역할은 **엔드투엔드**통신을 하는 것
- 보내고 싶은 데이터를 IP 패킷으로 만든다
	- IP로 데이터를 전송하기 위해서는 데이터 IP 헤더를 추가해 IP 패킷으로 만들어야 함
	- IP 헤더에는 IP 주소를 이용한 데이터의 출발지, 목적지 정보가 존재
	- IP로 전송하는 데이터 = 애플리케이션 데이터 + 애플리케이션 프로토콜 헤더 + 트랜스포트 프로토콜 헤드
	- IP 패킷은  네트워크 인터페이스 프로토콜의 헤더가 추가되어 네트워크로 보내짐
	- 목적지가 다른 네트워크인 경우 라우터를 이용
	- **라우팅:** 라우터가 IP 패킷을 전송하는 것

## 3.8. 통신 상대는 누구?
- IP 주소의 개요
	- IP 주소: TCP/IP 통신 상대가 되는 호스트를 식별하기 위한 식별 정보
- 인터페이스에 IP 주소를 설정한다
	- IP 주소는 이더넷 등의 인터페이스와 연관 지어 설정
	- IP 프로토콜은 호스트의 운영체제에서 동작
	- IP 주소는 호스트 자체가 아니라 호스트의 인터페이스를 식별

## 3.9. 목적지는 하나? 아니면 여러개?
- 유니캐스트: 단 한 곳으로 데이터를 전송하는 것을 **유니캐스트**라고 부름
- 브로드캐스트: 같은 네트워 상의 모든 호스트에 완전히 똑같은 데이터를 전송
- 멀티캐스트: 같은 애플리케이션 or 특정 그룹에 포함되는 호스트에 완전해 똑같은 데이터를 전송하는 것

## 3.10. IP 주소의 구성은 크게 나눠 두 가지
- 유니캐스트 IP 주소의 구성
	- TCP/IP 통신의 대부분은 유니캐스트
	- IP 주소는 네트워크와 호스트부라는 두개의 부분으로 구성
	- 사내 네트워크와 인터넷 등은 복수의 네트워크가 라우터 또는 L3스위치로 서로 연결되어 있음
- 브로드캐스트 IP 주소
	- 같은 네트워크에 있는 모든 호스트에 일괄적으로 데이터를 전송할 때 이용하는 브로드캐스트 IP 주소는  
		32비트가 모두 1인 IP 주소(10진수 표시시 255.255.255.255)
- 멀티캐스트 IP 주소
	- 멀티캐스트 IP 주소 범위는 ``224.0.0.0 ~ 239.255.255.255``
	- 멀티캐스트 IP 주소 범위 중에는 미리 정해진 IP 주소가 있음

# 3.11. IP 주소의 범위 구분
- 서브넷마스크란?
	- 32비트 IP 주소의 어디까지가 네트워크부인지 명시한 것이 **서브넷마스크**
	- IP 주소처럼 32비트이며 0과 1로 이루어져 있음(1은 네트워크, 0은 호스트 부분을 나타냄)
- 네트워크 주소와 브로드캐스트 주소
	- 모든 비트를 0으로 채우면 네트워크 자체를 식별하기 위해 이용하는 **네트워크 주소**이다  
		(네트워크 자체를 식별할때 네트워크 주소를 이용)
	- 모든 비트를 1로 채우면 **브로드캐스트 주소**이다 

## 3.12. 네트워크에 접속하는 두 단계
- 물리적인 접속과 논리적인 접속
	- 물리적인 접속은 네트워크 인터페이스
	- 논리적인 접속은 인터넷

## 3.13. 인터넷에서 사용하는 주소와 사설 네트워크에서 사용하는 주소
- IP 주소의 이용 범위
	- IP 주소는 이용 범위에 따라 **공인/사설 IP 주소** 분류
- 사설 네트워크에서 인터넷으로의 통신
	- 사설 네트워크에서 인터넷으로 통신하려면 **NAT**가 필요

## 3.14. 사설 네트워크에서 인터넷으로의 통신
- 사설 주소 그대로는 응답이 돌아오지 않는다
	- 인터넷에서는 목적지가 사설 주소로 된 IP 패킷은 반드시 폐기되어 버림
- 주소를 변환한다
	- 사설 네트워크에서 인터넷으로 통신하기 위해서는 NAT로 주소를 변환
		1. 사설 네트워크에서 인터넷으로 요청을 전송할때 출발지 IP 주소를 변환
		2. 라우터는 나중에 원래대로 되돌리기 위해 변환한 주소의 매핑정보를 NAT 테이블에 보존
		3. 요청에 대한 응답이 라우터로 돌아오면 목적지 IP 주소를 변환 (라우터의 NAT 테이블과 매핑)
	- 복수의 사설 주소를 하나의 글로벌 주소에 대응시키는 주소 변환을 NAPT(Network Address Port Translation)라고 함

## 3.15. 데이터가 목적지에 잘 도착했을까?
- IP는 확인하지 않는다
	- IP는 데이터를 다른 호스트에 전송하지만, 제대로 도착을 했는지 확인 할 방법이 없음
- ICMP(Internet Control Message Protocl)의 기능
	- ICMP는 IP에 의한 ``엔드투엔드`` 통신이 정상적으로 이루어졌는지 확인하는 프로토콜
	- 에러 리포트: 어떤 이유로 IP 패킷을 폐기했다면 출발지로 에러 리포토를 전송
	- 진단 기능: IP의 ``엔드투엔드`` 통신이 가능하지 확인하는 기능(ex. ping 명령어)

## 3.16. IP 주소와 MAC 주소를 대응시킨다
- ARP란?
	- TCP/IP의 IP 주소와 인터페이스를 식별하기 위한 MAC 주소를 대응시키는 것,  
		목적지 IP 주소에 대응하는 MAC 주소를 구하기 위해서 ARP를 이용
	- 이더넷 헤더에는 목적지 MAC 주소를 지정해야 함
	- IP 주소와 MAC 주소를 대응시키는 것을 가리켜 **주소 해석**이라고 함
- ARP 동작의 흐름
	- ARP의 주소 해석 범위는 같은 네트워크 내의 IP 주소이다
	- IP 패킷을 송신하고자 목적지 IP 주소를 지정할때 자동으로 ARP가 수행

## 3.17. 포토 번호로 애플리케이션에 할당한다
- 포트 번호의 역할
	- 애플리케이션을 식별하는 데에는 **포트 번호**를 이용
	- TCP or UDP 헤더에 포트 번호 지정(포트의 크기는 16bit=0~65535)

## 3.18. 확실하게 애플리케이션의 데이터를 전송한다
- TCP란?
	- 신뢰성 있는 애플리케이션 간의 데이터 전송을 하기 위한 프로토콜

## 3.19. TCP로 데이터를 분할한다
- TCP 헤더 형식
	- TCP 헤더에는 포트 번호가 있어 적절한 애플리케이션 프로토콜에 데이터를 배분할 수 있음
	- 신뢰성 있는 데이터 전송을 위해서 **시퀀스 번호**, **ACK 번호**를 사용
	- 시퀀스 번호: TCP로 전송하는 데이터 순서
	- ACK 번호: 데이터 수신을 정상적으로 확인
- 데이터 분할 구조
	- MMS(Maximum Message Size): TCP 애플리케이션의 데이터를 분활하는 단위, MMS의 표준 크기는 1460Byte

## 3.20. 애플리케이션에 데이터를 배분하기만 한다
- UDP
	- 애플리케이션 데이터를 적절하게 배분하는 기능만 있는 프로토콜
	- UDP 헤더와 애플리케이션의 데이터를 합치면 **UDP 데이터그램**이라고 부름
	- TCP 헤더 형식과 비교하면 UDP는 지극히 단순
- UDP 이용사례
	- 데이터 전송 효율이 좋다는 장점
	- 크기가 큰 데이터를 분할하는 기능이 없으므로 데이터 크기가 크면 애플리케이션에서 분할해야 함

## 3.21. 네트워크의 전화번호부
- DNS: 호스트 이름에 대응하는 IP 주소를 자동으로 구함

## 3.22. DNS로 IP 주소를 자동으로 구한다
- DNS 서버
	- DNS를 이용하려면 DNS 서버가 필요
	- DNS 서버에는 호스트명과 IP 주소를 매핑하여 등록
	- DNS 서버에 등록하는 정보를 **리소스 레코드**라고 함
- DNS의 이름해석
	- DNS 리졸버: DNS 서버에 질의하는 기능은 OS에 내정 

## 3.23. 필요한 설정을 자동화한다
- DHCP: TCP/IP 설정을 자동화하는 프로토콜
- DHCP의 동작
	1. DHCP 서버를 준비
	2. 할당된 IP 주소 등 TCP/IP 설정을 등록
	3. DHCP 클라이언트의 호스트가 네트워크에 접속하면, DHCP 서버와 4가지 메시지를 받으면 자동으로 TCP/IP 설정을 함
	> DHCP의 통신은 브로드캐스트를 이용
